version: "3.8"
services:
  wiki:
    image: ghcr.io/requarks/wiki:2
    environment:
      - WIKI_DB_TYPE=postgres
      - WIKI_DB_HOST=team-sermonlopedia-eus2.postgres.database.azure.com
      - WIKI_DB_PORT=5432
      - WIKI_DB_USER=wiki_user
      - WIKI_DB_PASS=${WIKI_DB_PASS}        # replace with your secret in production
      - WIKI_DB_NAME=wikijs
      - WIKI_DB_SSL=true
      - NODE_ENV=production
    ports:
      - "3000:3000"
    restart: unless-stopped

  wrapper:
    build: 
      context: ./wrapper
    environment:
      - WIKI_TARGET=http://wiki:3000
    ports:
      - "3001:3001"
    depends_on:
      - wiki
    restart: unless-stopped

  internet_scraper:
    build:
      context: ./internet_scraper
    restart: on-failure